(()=>{var e={389:(e,s,t)=>{const r=t(860),i=t(821),a=t(985),o=r();o.use(((e,s,t)=>{if(s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Allow-Headers","Authorization, Content-Type"),s.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE"),"OPTIONS"===e.method)return s.sendStatus(200);t()})),o.use("/images",r.static("images")),o.use(r.json()),o.use(i());const n=a({windowMs:9e5,max:100,standardHeaders:!0,legacyHeaders:!1});o.use("/api",n);const u=t(327),c=t(616);o.use("/api/auth",u),o.use("/api/sauces",c),e.exports=o},36:(e,s,t)=>{const r=t(147),i=t(10),a="images/",o="images/tmp/",n=e=>{r.unlinkSync(a+e)},u=e=>{r.unlinkSync(o+e)},c=e=>{const s=o+e,t=a+e;r.renameSync(s,t)};s.getAllSauces=(e,s)=>{i.find().then((e=>s.status(200).json(e))).catch((e=>s.status(500).json({message:e.message})))},s.createSauce=async(e,s)=>{if(!e.file)return s.status(400).json({message:"Image requise."});const t=e.body.sauce?JSON.parse(e.body.sauce):{},r=e.file.filename;t.userId=s.locals.userId,t.imageUrl=`${e.protocol}://${e.get("host")}/images/${r}`;try{await i.create({...t,likes:0,dislikes:0,usersLiked:[],usersDisliked:[]}),c(r),s.status(201).json({message:"Sauce enregistrÃ©e !"})}catch(e){u(r),s.status(400).json({message:e.message})}},s.getOneSauce=(e,s)=>{s.status(200).json(s.locals.sauce)},s.updateSauce=async(e,s)=>{const t=s.locals.sauce;if(e.headers["content-type"].includes("multipart/form-data")){if(!e.file)return s.status(400).json({message:"Image requise."});const r=e.body.sauce?JSON.parse(e.body.sauce):{},i=e.file.filename,a=t.imageUrl.split("/images/")[1];r.imageUrl=`${e.protocol}://${e.get("host")}/images/${i}`,delete r.likes,delete r.dislikes,delete r.usersLiked,delete r.usersDisliked,Object.assign(t,r);try{await t.save(),n(a),c(i),s.status(200).json({message:"Sauce modifiÃ©e !"})}catch(e){u(i),s.status(400).json({message:e.message})}}else{const r={...e.body};delete r.imageUrl,delete r.likes,delete r.dislikes,delete r.usersLiked,delete r.usersDisliked,Object.assign(t,r),t.save().then((()=>s.status(200).json({message:"Sauce modifiÃ©e !"}))).catch((e=>s.status(400).json({message:e.message})))}},s.deleteSauce=(e,s)=>{const t=s.locals.sauce,r=t.imageUrl.split("/images/")[1];n(r),i.deleteOne({_id:t._id}).then((()=>s.status(200).json({message:"Sauce supprimÃ©e !"}))).catch((e=>s.status(400).json({message:e.message})))},s.likeSauce=(e,s)=>{const t=s.locals.userId,r=s.locals.sauce,i=e.body.like;try{(e=>{const s="Mauvais format de donnÃ©e.";if(null==e)throw console.error("L'Ã©tat du like est requis."),Error(s);if("number"!=typeof e)throw console.error("L'Ã©tat du like doit Ãªtre un nombre."),Error(s);if(!(e>=-1&&e<=1))throw console.error("L'Ã©tat du like doit Ãªtre compris entre -1 et 1."),Error(s)})(i)}catch(e){return s.status(400).json({message:e.message})}let a;switch(i){case 1:if(r.hasLiked(t)){a="Sauce dÃ©jÃ  likÃ©e...";break}r.hasDisliked(t)&&r.undislike(t),r.like(t),a="Sauce likÃ©e !";break;case-1:if(r.hasDisliked(t)){a="Sauce dÃ©jÃ  dislikÃ©e...";break}r.hasLiked(t)&&r.unlike(t),r.dislike(t),a="Sauce dislikÃ©e !";break;case 0:case 0:r.hasLiked(t)?(r.unlike(t),a="Sauce unlikÃ©e !"):r.hasDisliked(t)?(r.undislike(t),a="Sauce undislikÃ©e !"):a="Sauce pas likÃ©e ni dislikÃ©e..."}r.save().then((()=>s.status(200).json({message:a}))).catch((e=>s.status(400).json({message:e.message})))}},612:(e,s,t)=>{const r=t(96),i=t(344),a=t(564),o=t(862);s.signup=async(e,s)=>{try{const t=e.body.email,i=e.body.password;(e=>{if(""===e||null==e)throw Error("Mot de passe requis.");if("string"!=typeof e)throw Error("Le mot de passe doit Ãªtre une chaÃ®ne de caractÃ¨res.");if(!(e.length<=50))throw Error("Le mot de passe ne doit pas excÃ©der 50 caractÃ¨res.");if(!a.isStrongPassword(e))throw Error("Le mot de passe n'est pas valide. Liste des requis :\n- 8 caractÃ¨res minimum\n- 1 lettre minuscule\n- 1 lettre majuscule\n- 1 chiffre\n- 1 symbole")})(i);const n=await r.hash(i,10);await o.create({email:t,password:n}),s.status(201).json({message:"Utilisateur crÃ©Ã© !"})}catch(e){s.status(400).json({message:e.message})}},s.login=async(e,s)=>{const t=e.body.email,a=e.body.password,n="L'email ou le mot de passe est incorrect.";try{if(""===t||null==t)throw Error("Email requis.");if(""===a||null==a)throw Error("Mot de passe requis.")}catch(e){return s.status(400).json({message:e.message})}const u=await o.findOne({email:t});if(!u)return s.status(401).json({message:n});if(!await r.compare(a,u.password))return s.status(401).json({message:n});const c=u._id;try{const e=i.sign({userId:c},process.env.TOKEN_SECRET_KEY,{expiresIn:"24h"});s.status(200).json({userId:c,token:e})}catch(e){console.error(e),s.status(500).json({message:e.message})}}},38:(e,s,t)=>{const r=t(185);r.connect(process.env.MONGO_DB_KEY).then((()=>console.log("Connected to MongoDB âœ”"))).catch((e=>{console.error("Failed to connect to MongoDB âœ–"),console.error(e)})),r.connection.on("error",console.error)},752:(e,s,t)=>{const r=t(344),i=t(862);s.token=async(e,s,t)=>{try{const a=e.headers.authorization?.split(" ")[1],o=r.verify(a,process.env.TOKEN_SECRET_KEY).userId;if(!await i.findById(o))throw{message:"L'utilisateur n'existe plus"};if(e.body.userId&&e.body.userId!==o)throw{message:"Non autorisÃ©"};s.locals.userId=o,t()}catch(e){s.status(401).json(e)}},s.sauce=(e,s,t)=>{const r=s.locals.userId;if(s.locals.sauce.userId!==r)return s.status(403).json({message:"Sauce non possÃ©dÃ©e..."});t()}},429:(e,s,t)=>{const r=t(738),i=["jpg","jpeg","png"],a=r.diskStorage({destination:(e,s,t)=>t(null,"images/tmp"),filename:(e,s,t)=>{const r=Date.now(),i=Math.random().toString().slice(2);let a=s.mimetype.split("/")[1];"jpeg"===a&&(a="jpg"),t(null,`sauce_${r}_${i}.${a}`)}}),o=(e,s,t)=>{const r=s.mimetype.split("/")[1];if(!i.includes(r))return t(Error(`Image invalide (extensions autorisÃ©es : ${i.join("/")}).`));t(null,!0)};e.exports=(e,s,t)=>{r({storage:a,fileFilter:o}).single("image")(e,s,(e=>{if(e)return s.status(400).json({message:e.message});t()}))}},10:(e,s,t)=>{const r=t(185),i=r.Schema({userId:{type:String,required:!0,immutable:!0},name:{type:String,required:[!0,"Le nom est requis."],maxLength:[50,"Le nom ne doit pas excÃ©der 50 caractÃ¨res."],match:[/^[a-zA-Z\d '\-]*$/,"Le nom est invalide. CaractÃ¨res autorisÃ©s :\n- lettres minuscules\n- lettres majuscules\n- chiffres\n- autres ('- )"]},manufacturer:{type:String,required:!0,maxLength:50,match:[/^[a-zA-Z\d '\-()]*$/,"Le champ manufacturer est invalide. CaractÃ¨res autorisÃ©s :\n- lettres minuscules\n- lettres majuscules\n- chiffres\n- autres ('- ())"]},description:{type:String,required:!0,maxLength:500},mainPepper:{type:String,required:!0,maxLength:50,match:[/^[a-zA-Z\d '\-]*$/,"Le champ main pepper est invalide. CaractÃ¨res autorisÃ©s :\n- lettres minuscules\n- lettres majuscules\n- chiffres\n- autres ('- )"]},imageUrl:{type:String,required:!0},heat:{type:Number,required:!0,min:1,max:10},likes:{type:Number,required:!0},dislikes:{type:Number,required:!0},usersLiked:{type:[String],required:!0},usersDisliked:{type:[String],required:!0}});i.methods.like=function(e){this.likes++,this.usersLiked.push(e)},i.methods.dislike=function(e){this.dislikes++,this.usersDisliked.push(e)},i.methods.unlike=function(e){this.likes--,this.usersLiked.splice(this.usersLiked.indexOf(e),1)},i.methods.undislike=function(e){this.dislikes--,this.usersDisliked.splice(this.usersDisliked.indexOf(e),1)},i.methods.hasLiked=function(e){return this.usersLiked.find((s=>s===e))},i.methods.hasDisliked=function(e){return this.usersDisliked.find((s=>s===e))},e.exports=r.model("Sauce",i)},862:(e,s,t)=>{const r=t(185),i=t(288),a=t(564),o=r.Schema({email:{type:String,unique:!0,lowercase:!0,required:!0,maxLength:50,validate:{validator:function(e){return a.isEmail(e)},message:"L'email n'est pas valide."}},password:{type:String,required:!0}});o.plugin(i),e.exports=r.model("User",o)},616:(e,s,t)=>{const r=t(860).Router(),i=t(752),a=t(429),o=t(10),n=t(36);r.use(i.token),r.route("/").get(n.getAllSauces).post(a,n.createSauce),r.route("/:id").get(n.getOneSauce).put(i.sauce,a,n.updateSauce).delete(i.sauce,n.deleteSauce),r.post("/:id/like",n.likeSauce),r.param("id",(async(e,s,t,r)=>{try{const e=await o.findById(r);if(!e)return s.status(404).json({message:"Sauce introuvable..."});s.locals.sauce=e,t()}catch(e){s.status(400).json({message:e.message})}})),e.exports=r},327:(e,s,t)=>{const r=t(860).Router(),i=t(612);r.post("/signup",i.signup),r.post("/login",i.login),e.exports=r},96:e=>{"use strict";e.exports=require("bcrypt")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},821:e=>{"use strict";e.exports=require("express-mongo-sanitize")},985:e=>{"use strict";e.exports=require("express-rate-limit")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},185:e=>{"use strict";e.exports=require("mongoose")},288:e=>{"use strict";e.exports=require("mongoose-unique-validator")},738:e=>{"use strict";e.exports=require("multer")},564:e=>{"use strict";e.exports=require("validator")},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")}},s={};function t(r){var i=s[r];if(void 0!==i)return i.exports;var a=s[r]={exports:{}};return e[r](a,a.exports,t),a.exports}(()=>{t(142).config(),t(38);const e=t(389),s=t(685).createServer(e);try{s.listen(process.env.PORT||3e3)}catch(e){console.error(e),process.exit(1)}s.on("listening",(()=>{console.log("Welcome to Piiquante ðŸŒ¶"),console.log(`Listening on port ${s.address().port} âœ”`)})),s.on("error",(e=>{console.error(e),process.exit(1)}))})()})();