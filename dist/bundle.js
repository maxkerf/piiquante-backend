(()=>{var e={389:(e,s,t)=>{const i=t(185);i.connect(process.env.MONGO_DB_KEY).then((()=>console.log("Connected to MongoDB!"))).catch((e=>{console.error("Failed to connect to MongoDB..."),console.error(e)})),i.connection.on("error",console.error);const r=t(860),o=r();o.use(((e,s,t)=>{if(s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Allow-Headers","Authorization, Content-Type"),s.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE"),"OPTIONS"===e.method)return s.sendStatus(200);t()})),o.use("/images",r.static("images")),o.use(r.json());const a=t(327),n=t(616);o.use("/api/auth",a),o.use("/api/sauces",n),e.exports=o},36:(e,s,t)=>{const i=t(147),r=t(10),o=["jpg","jpeg","png"],a=(e,s)=>{let t,r=!0;return e?o.find((s=>e.mimetype.split("/")[1]===s))||(r=!1,t=`Image invalide (extensions autorisées : ${o.join("/")}).`,i.unlink(`images/tmp/${e.filename}`,(e=>{e&&console.error(e)}))):(r=!1,t="Image requise."),r||s.status(400).json({message:t}),r};s.getAllSauces=(e,s)=>{r.find().then((e=>s.status(200).json(e))).catch((e=>s.status(500).json(e)))},s.createSauce=async(e,s)=>{if(!a(e.file,s))return;const t=e.body.sauce?JSON.parse(e.body.sauce):{},o=e.file.filename;t.userId=s.locals.userId,t.imageUrl=`${e.protocol}://${e.get("host")}/images/${o}`;try{await r.create({...t,likes:0,dislikes:0,usersLiked:[],usersDisliked:[]});const e=`images/tmp/${o}`,a=`images/${o}`;i.rename(e,a,(e=>{e&&console.error(e)})),s.status(201).json({message:"Sauce enregistrée !"})}catch(e){i.unlink(`images/tmp/${o}`,(e=>{e&&console.error(e)})),s.status(400).json(e)}},s.getOneSauce=(e,s)=>{s.status(200).json(s.locals.sauce)},s.updateSauce=async(e,s)=>{const t=s.locals.sauce;if("multipart/form-data"===e.headers["content-type"].split(";")[0]){if(!a(e.file,s))return;const r=e.body.sauce?JSON.parse(e.body.sauce):{},o=e.file.filename,n=t.imageUrl.split("/images/")[1];r.imageUrl=`${e.protocol}://${e.get("host")}/images/${o}`,delete r.likes,delete r.dislikes,delete r.usersLiked,delete r.usersDisliked,Object.assign(t,r);try{await t.save(),i.unlink(`images/${n}`,(e=>{e&&console.error(e)}));const e=`images/tmp/${o}`,r=`images/${o}`;i.rename(e,r,(e=>{e&&console.error(e)})),s.status(200).json({message:"Sauce modifiée !"})}catch(e){i.unlink(`images/tmp/${o}`,(e=>{e&&console.error(e)})),s.status(400).json(e)}}else{const i={...e.body};delete i.imageUrl,delete i.likes,delete i.dislikes,delete i.usersLiked,delete i.usersDisliked,Object.assign(t,i),t.save().then((()=>s.status(200).json({message:"Sauce modifiée !"}))).catch((e=>s.status(400).json(e)))}},s.deleteSauce=(e,s)=>{const t=s.locals.sauce,o=t.imageUrl.split("/images/")[1];i.unlink(`images/${o}`,(e=>{e&&console.error(e),r.deleteOne({_id:t._id}).then((()=>s.status(200).json({message:"Sauce supprimée !"}))).catch((e=>s.status(500).json(e)))}))},s.likeSauce=(e,s)=>{const t=s.locals.userId,i=s.locals.sauce,r=e.body.like;let o;if(((e,s)=>{let t,i=!0;return""===e||void 0===e?(i=!1,t="L'état du like est requis."):"number"!=typeof e?(i=!1,t="L'état du like doit être un nombre."):e>=-1&&e<=1||(i=!1,t="L'état du like doit être compris entre -1 et 1."),i||s.status(400).json({message:t}),i})(r,s)){try{switch(r){case 1:if(i.hasLiked(t))throw Error("Sauce déjà likée...");i.hasDisliked(t)&&i.undislike(t),i.like(t),o="Sauce likée !";break;case-1:if(i.hasDisliked(t))throw Error("Sauce déjà dislikée...");i.hasLiked(t)&&i.unlike(t),i.dislike(t),o="Sauce dislikée !";break;case 0:case 0:if(i.hasLiked(t))i.unlike(t),o="Sauce unlikée !";else{if(!i.hasDisliked(t))throw Error("Sauce pas likée ni dislikée...");i.undislike(t),o="Sauce undislikée !"}}}catch(e){return s.status(400).json({message:e.message})}i.save().then((()=>s.status(200).json({message:o}))).catch((e=>s.status(400).json(e)))}}},612:(e,s,t)=>{const i=t(96),r=t(344),o=t(862),a=(e,s)=>{let t,i=!0;return""===e||void 0===e?(i=!1,t="Mot de passe requis."):"string"!=typeof e?(i=!1,t="Le mot de passe doit être une chaîne de caractères."):e.length<=50||(i=!1,t="Le mot de passe ne doit pas excéder 50 caractères."),i||s.status(400).json({message:t}),i};s.signup=async(e,s)=>{try{const t=e.body.email,r=e.body.password;if(!a(r,s))return;const n=await i.hash(r,10);await o.create({email:t,password:n}),s.status(201).json({message:"Utilisateur créé !"})}catch(e){s.status(400).json(e)}},s.login=async(e,s)=>{try{const t=e.body.email,n=e.body.password,u=await o.findOne({email:t});if(!u)return s.status(400).json({message:"Utilisateur non trouvé..."});if(!a(n,s))return;if(!await i.compare(n,u.password))return s.status(401).json({message:"Mot de passe incorrect..."});const c=u._id,l=r.sign({userId:c},process.env.TOKEN_SECRET_KEY,{expiresIn:"24h"});s.status(200).json({userId:c,token:l})}catch(e){s.status(400).json(e)}}},752:(e,s,t)=>{const i=t(344);s.token=(e,s,t)=>{try{const r=e.headers.authorization?.split(" ")[1],o=i.verify(r,process.env.TOKEN_SECRET_KEY);s.locals.userId=o.userId,t()}catch(e){s.status(401).json({error:e})}},s.sauce=(e,s,t)=>{const i=s.locals.userId;if(s.locals.sauce.userId!==i)return s.status(403).json({message:"Sauce non possédée..."});t()}},204:(e,s,t)=>{const i=t(738),r=i.diskStorage({destination:(e,s,t)=>t(null,"images/tmp"),filename:(e,s,t)=>{const i=Date.now(),r=Math.random().toString().slice(2);let o=s.mimetype.split("/")[1];"jpeg"===o&&(o="jpg"),t(null,`sauce_${i}_${r}.${o}`)}});e.exports=i({storage:r}).single("image")},10:(e,s,t)=>{const i=t(185),r=i.Schema({userId:{type:String,required:!0,immutable:!0},name:{type:String,required:!0,maxLength:[50,"Le nom ne doit pas excéder 50 caractères."],match:/^[a-zA-Z]*$/},manufacturer:{type:String,required:!0,maxLength:50,match:/^[a-zA-Z]*$/},description:{type:String,required:!0,maxLength:500},mainPepper:{type:String,required:!0,maxLength:50,match:/^[a-zA-Z]*$/},imageUrl:{type:String,required:!0},heat:{type:Number,required:!0,min:1,max:10},likes:{type:Number,required:!0},dislikes:{type:Number,required:!0},usersLiked:{type:[String],required:!0},usersDisliked:{type:[String],required:!0}});r.methods.like=function(e){this.likes++,this.usersLiked.push(e)},r.methods.dislike=function(e){this.dislikes++,this.usersDisliked.push(e)},r.methods.unlike=function(e){this.likes--,this.usersLiked.splice(this.usersLiked.indexOf(e),1)},r.methods.undislike=function(e){this.dislikes--,this.usersDisliked.splice(this.usersDisliked.indexOf(e),1)},r.methods.hasLiked=function(e){return this.usersLiked.find((s=>s===e))},r.methods.hasDisliked=function(e){return this.usersDisliked.find((s=>s===e))},e.exports=i.model("Sauce",r)},862:(e,s,t)=>{const i=t(185),r=t(288),o=i.Schema({email:{type:String,required:!0,lowercase:!0,unique:!0,maxLength:50,match:/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/},password:{type:String,required:!0}});o.plugin(r),e.exports=i.model("User",o)},616:(e,s,t)=>{const i=t(860).Router(),r=t(752),o=t(204),a=t(10),n=t(36);i.use(r.token),i.route("/").get(n.getAllSauces).post(o,n.createSauce),i.route("/:id").get(n.getOneSauce).put(r.sauce,o,n.updateSauce).delete(r.sauce,n.deleteSauce),i.post("/:id/like",n.likeSauce),i.param("id",(async(e,s,t,i)=>{try{const e=await a.findById(i);if(!e)throw{message:"Sauce introuvable..."};s.locals.sauce=e,t()}catch(e){s.status(400).json(e)}})),e.exports=i},327:(e,s,t)=>{const i=t(860).Router(),r=t(612);i.post("/signup",r.signup),i.post("/login",r.login),e.exports=i},96:e=>{"use strict";e.exports=require("bcrypt")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},185:e=>{"use strict";e.exports=require("mongoose")},288:e=>{"use strict";e.exports=require("mongoose-unique-validator")},738:e=>{"use strict";e.exports=require("multer")},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")}},s={};function t(i){var r=s[i];if(void 0!==r)return r.exports;var o=s[i]={exports:{}};return e[i](o,o.exports,t),o.exports}(()=>{t(142).config();const e=t(685),s=t(389),i=e.createServer(s);try{i.listen(process.env.PORT||3e3)}catch(e){console.error(e),process.exit(1)}i.on("listening",(()=>console.log(`Listening on port ${i.address().port}!`))),i.on("error",(e=>{console.error(e),process.exit(1)}))})()})();